{
  "name": "Register Patient response",
  "endpoint": {
    "pattern": "/register-response",
    "method": "POST"
  },
  "transformation": {
    "input": "JSON",
    "output": "JSON"
  },
  "inputTransforms": {
    "currentDate": "$now()",
    "sourcePatient": "$exists(requestBody.identifier) and $exists(requestBody.identifier[0]) and $exists(requestBody.identifier[0].value) ? {'patient': requestBody.identifier[0].value, 'facility': requestBody.identifier[0].system} : null",
    "pin": "$exists(requestBody.identifier) and $exists(requestBody.identifier[0]) and $count($filter(requestBody.identifier, function($v) {$contains($v.system, 'NationalID')})) > 0 ? $filter(requestBody.identifier, function($v) {$contains($v.system, 'NationalID')})[0].value : null",
    "firstName": "$exists(requestBody.name) and $exists(requestBody.name[0]) and $exists(requestBody.name[0].given[0]) ? requestBody.name[0].given[0] : null",
    "middleName": "$exists(requestBody.name) and $exists(requestBody.name[0]) and $exists(requestBody.name[0].given[1]) ? requestBody.name[0].given[1] : null",
    "surname": "$exists(requestBody.name) and $exists(requestBody.name[0]) ? requestBody.name[0].family : null",
    "chiefdomCode": "$exists(requestBody.extension) and $exists(requestBody.extension[1]) ? requestBody.extension[1].valueCodeableConcept.text : null",
    "cellPhone": "$exists(requestBody.telecom) and $exists(requestBody.telecom[0]) ? requestBody.telecom[0].value : null"
  },
  "inputMapping": {
    "transforms.sourcePatient": "sourceId",
    "transforms.pin": "demographicData.pin",
    "transforms.surname": "demographicData.surname",
    "transforms.firstName": "demographicData.firstName",
    "transforms.middleName": "demographicData.middleName",
    "requestBody.gender": "demographicData.sex",
    "requestBody.birthDate": "demographicData.dob",
    "transforms.chiefdomCode": "demographicData.chiefdomCode",
    "transforms.cellPhone": "demographicData.cellPhone",
    "transforms.currentDate": "uniqueInteractionData.auxDateCreated"
  },
  "requests": {
    "response": {
      "id": "jempi",
      "primary": true,
      "config": {
        "method": "post",
        "headers": {
          "contentType": "application/fhir+json"
        },
        "url": "http://jempi-api:50000/JeMPI/crLink"
      }
    }
  }
}
